---
title: "P8105 Homework 5"
name: "Jessie Wong"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(rvest)
```

## Problem 1 

The `data` zip file that we are using in this problem is from a longitudinal study that has a control arm and an experimental arm. 

Create a tidy dataframe containing data from all participants, including the subject ID, arm, and observations over time:

- Started with a dataframe containing all file names; the `list.files` function will help 
- Iterate over file names and read in data for each subject using  purrr::map and saving the result as a new variable in the dataframe
```{r}
data_df = tibble(subject_ID = list.files(path = "./data", pattern = "*.csv", full.names = T)) %>%
  mutate(study1 = map(subject_ID, read_csv)) %>%
  unnest()
```

- Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary
```{r}
study_df = data_df %>%
  gather(key = week, value = observation, week_1:week_8) %>%
  separate(week, into = c("remove_1", "week"), sep = "_") %>%
  separate(subject_ID, into = c("arm", "subject_id"), sep = "_") %>%
  separate(arm, into = c("remove_2", "arm"), sep = 7) %>%
  separate(subject_id, into = c("subject_id", "remove_3"), sep = 2) %>%
  select(-starts_with("remove")) %>%
  arrange(arm, subject_id, week)

study_df$arm[study_df$arm == "con"] = "control"
study_df$arm[study_df$arm == "exp"] = "experimental"
```

Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups
```{r}
study_df %>% 
  group_by(week, arm) %>% 
  ggplot(aes(x = week, y = observation, group = subject_id, color = subject_id)) +
  geom_path() + 
  facet_grid(~arm) +
  labs(title = "Observation Across Study Arm Subjects During Week 1-8") + 
  viridis::scale_color_viridis(
    name = "subject", 
    discrete = TRUE)
```

```{r}

```

